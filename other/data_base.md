# 数据库

# TODO

事务
* mongodb 4.0版本之前没有事务管理

### 并发控制：

悲观锁：
* 悲观：并发修改的概率比较大
* 借用数据库锁机制（for update），先锁再访问（修改）
* 尝试加排他锁，加锁失败说明该记录正在被修改
* 效率低，死锁率高
* 使用的越来越少了 -.-!

乐观锁：
* 乐观：假设数据一般情况下不会造成冲突
* 冲突检测和数据更新
  * 可以利用 version 来检查是否过期
  * 可以用> <来提高颗粒度
  * 一旦锁的粒度掌握不好，就容易发生业务失败
