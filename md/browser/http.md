# 关于 Http

关于 https 加密相关、tcp 相关内容在 [从输入URL到页面加载过程](https://zhongmeizhi.github.io/fed-note/browser/page_load.html)


### 从 http1.0 到 http1.1

在浏览器中，越来越多的使用更多的图片和更多的懒加载组件，然后会导致页面加载时会加载很多的几kb文件，

因此 http 经过了好几代的更新。

从古老的 http1.0 开始，它存在的以下的问题

1. 在http1.0中，发送一次请求时，需要等待服务端响应了才可以继续发送请求。
2. 连接方式是短链接

为了解决上述 http1.0 的问题，出现了 http 1.1，它主要做了以下改动

1. 持久连接：出现了默认长连接方式 `keep-alive`
2. 请求管道化：发送一次请求时，不需要等待服务端响应了就可以发送请求了。
3. 增加缓存处理：新的字段如 `cache-control`
4. 增加Host字段、支持断点传输等


`keep-alive`：在规定时间内，同一域名多次请求数据，只建立一次HTTP请求，后续请求可复用之前的连接通道。该规定时间默认为`2小时`，可以通过 `Apache` 或者 `nginx` 配置。

但是，http1.1的问题依然存在

1. 在 http1.1中，基于请求-响应的模型，在同一个 TCP 长连接中，前面的请求没有得到响应，后面的请求就会被阻塞，服务器回送数据给客户端的时候，客户端需要按照响应的顺序来一一接收。也就是**线头阻塞**。
2. 在 http1.1 中无论是请求还是响应都是**基于文本**的，在数据传输的过程中服务器并不知道字符的顺序。所以：keep-alive 对于单文件的传输是block级的，数据必须按顺序传输，不能并行。


### 从 http1.1 到 http2

2015年 出现了 http2，它引入了 `二进制数据帧` 和 `流` 的概念，**利用帧对数据进行顺序标识，利用流进行数据并行传输**

主要改进点

1. 头部压缩 -> 减少体积
   * 采用`HPACK`压缩：利用服务器和客户端之间建立哈希表的映射，传递索引来精简和复用请求头部
2. 二进制 + 分帧传输 -> 减少体积 + 提高安全性
   * 由于 HTTP 的明文传输解析太过复杂（比如 `\n` 到底是换行还是字符串？），而且并不安全。所以，采用二进制进行传输
   * 将数据以流的形式进行传输，并将请求和响应数据分割成更小的帧，而多个帧之间可以乱序发送，根据帧首部的流标识来重新组装。
3. 多路复用 -> 解决队头阻塞
   * 只需要占用一个 TCP 连接
4. 服务器推送

PS：2020年2月chrome更改了`SameSite` 属性（从默认 `None` 改为 `Lax`），用以预防`CSRF` 攻击。
